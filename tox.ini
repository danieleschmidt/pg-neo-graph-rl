[tox]
envlist = py39, py310, py311, lint, type-check, security, docs
isolated_build = true

[testenv]
deps = 
    pytest>=7.0
    pytest-cov>=4.0
    pytest-xdist>=3.0
    pytest-mock>=3.10
    pytest-benchmark>=4.0
    pytest-timeout>=2.1
    psutil>=5.9.0
extras = dev
commands = 
    pytest {posargs:tests/} --cov=pg_neo_graph_rl --cov-report=term --cov-report=xml

[testenv:py39]
basepython = python3.9

[testenv:py310] 
basepython = python3.10

[testenv:py311]
basepython = python3.11

[testenv:lint]
skip_install = false
deps = 
    black
    ruff
    pre-commit
commands = 
    black --check .
    ruff check .
    pre-commit run --all-files

[testenv:type-check]
deps = 
    mypy
    types-all
extras = dev
commands = 
    mypy pg_neo_graph_rl/

[testenv:security]
deps = 
    bandit[toml]
    safety
commands = 
    bandit -r pg_neo_graph_rl/ -f json -o bandit-report.json
    safety check --json --output safety-report.json

[testenv:docs]
changedir = docs
deps = 
    sphinx
    sphinx-rtd-theme
extras = dev
commands = 
    sphinx-build -W -b html -d {envtmpdir}/doctrees . {envtmpdir}/html

[testenv:benchmark]
deps = 
    pytest
    pytest-benchmark
extras = dev,benchmarks
commands = 
    pytest tests/benchmarks/ --benchmark-only

[testenv:integration]
deps = 
    pytest
    pytest-cov
extras = dev
commands = 
    pytest tests/integration/ --cov=pg_neo_graph_rl

[testenv:coverage]
deps = 
    pytest
    pytest-cov
    coverage[toml]
extras = dev
commands = 
    coverage erase
    pytest --cov=pg_neo_graph_rl --cov-report=
    coverage report --show-missing
    coverage html

[testenv:clean]
deps = 
skip_install = true
commands = 
    python -c "import shutil; shutil.rmtree('build', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('dist', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.pytest_cache', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('htmlcov', ignore_errors=True)"